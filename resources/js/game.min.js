var x,y,height,width,socket,playerDir={UP:87,DOWN:83,LEFT:65,RIGHT:68},playerSize=50,bulletSize=10,player={id:(new Date).getTime().toString(),score:0,quad:{tlx:0,tly:0,trx:0,"try":0,blx:0,bly:0,brx:0,bry:0},bullets:[],dir:playerDir.UP},enemies={},dead=!1,playersKilled=[],hasMoved=!1;
function setup(){socket=io();height=windowHeight-15;width=windowWidth-15;x=random(width);y=random(height);createCanvas(width,height);socket.on("move",function(a){a.id!==player.id&&(enemies[+a.id]=a)});socket.on("shoot",function(a){a.id!==player.id&&(enemies[+a.id]=a)});socket.on("killed",function(a){a.id!==player.id&&(enemies[+a.id]="deleted")})}
function draw(){if(dead)textSize(50),text("YOU DIED!",width/3,height/3),fill(255,0,0);else{keyIsDown(playerDir.UP)&&(y-=4,player.dir=playerDir.UP,hasMoved=!0);keyIsDown(playerDir.LEFT)&&(x-=4,player.dir=playerDir.LEFT,hasMoved=!0);keyIsDown(playerDir.DOWN)&&(y+=4,player.dir=playerDir.DOWN,hasMoved=!0);keyIsDown(playerDir.RIGHT)&&(x+=4,player.dir=playerDir.RIGHT,hasMoved=!0);clear();background(0,0,0);updateBullet();var a={},c;for(c in enemies){a.e=enemies[+c];if("deleted"!==a.e){strokeWeight(8);stroke(255,
0,0);switch(a.e.dir){case playerDir.UP:line(a.e.quad.tlx,a.e.quad.tly,a.e.quad.trx,a.e.quad["try"]);break;case playerDir.DOWN:line(a.e.quad.blx,a.e.quad.bly,a.e.quad.brx,a.e.quad.bry);break;case playerDir.LEFT:line(a.e.quad.tlx,a.e.quad.tly,a.e.quad.blx,a.e.quad.bly);break;case playerDir.RIGHT:line(a.e.quad.trx,a.e.quad["try"],a.e.quad.brx,a.e.quad.bry)}strokeWeight(0);stroke(0);a.e.bullets.forEach(function(a){return function(b){if(b.y>=height||0>=b.y)a.e.bullets=a.e.bullets.filter(function(a){return a!==
b});else switch(b.dir){case playerDir.UP:b.y-=10;break;case playerDir.DOWN:b.y+=10;break;case playerDir.LEFT:b.x-=10;break;case playerDir.RIGHT:b.x+=10}collideRectCircle(player.quad.tlx,player.quad.tly,playerSize,playerSize,b.x,b.y,bulletSize,bulletSize)?(dead=!0,socket.emit("killed",player)):ellipse(b.x,b.y,bulletSize,bulletSize)}}(a));quad(a.e.quad.tlx,a.e.quad.tly,a.e.quad.trx,a.e.quad["try"],a.e.quad.brx,a.e.quad.bry,a.e.quad.blx,a.e.quad.bly)}a={e:a.e}}player.quad.tlx=x;player.quad.tly=y;player.quad.trx=
x+playerSize;player.quad["try"]=y;player.quad.brx=x+playerSize;player.quad.bry=y+playerSize;player.quad.blx=x;player.quad.bly=y+playerSize;hasMoved&&socket.emit("move",player);strokeWeight(8);stroke(0,0,255);switch(player.dir){case playerDir.UP:line(player.quad.tlx,player.quad.tly,player.quad.trx,player.quad["try"]);break;case playerDir.DOWN:line(player.quad.blx,player.quad.bly,player.quad.brx,player.quad.bry);break;case playerDir.LEFT:line(player.quad.tlx,player.quad.tly,player.quad.blx,player.quad.bly);
break;case playerDir.RIGHT:line(player.quad.trx,player.quad["try"],player.quad.brx,player.quad.bry)}strokeWeight(0);stroke(0);quad(player.quad.tlx,player.quad.tly,player.quad.trx,player.quad["try"],player.quad.brx,player.quad.bry,player.quad.blx,player.quad.bly)}hasMoved=!1}
function shoot(){if(!dead){switch(player.dir){case playerDir.UP:var a=player.quad.tlx+playerSize/2;var c=player.quad.tly;break;case playerDir.DOWN:a=player.quad.blx+playerSize/2;c=player.quad.bry;break;case playerDir.LEFT:a=player.quad.tlx;c=player.quad.bly-playerSize/2;break;case playerDir.RIGHT:a=player.quad.trx,c=player.quad.bry-playerSize/2}player.bullets.push({x:a,y:c,dir:player.dir});socket.emit("shoot",player)}}function keyPressed(){32===keyCode&&shoot()}
function updateBullet(){dead||player.bullets.forEach(function(a){var c=!0;if(a.y>=height||0>=a.y)player.bullets=player.bullets.filter(function(b){return b!==a});else switch(a.dir){case playerDir.UP:a.y-=10;break;case playerDir.DOWN:a.y+=10;break;case playerDir.LEFT:a.x-=10;break;case playerDir.RIGHT:a.x+=10}for(var d in enemies){var b=enemies[+d];"deleted"!==b&&(b=collideRectCircle(b.quad.tlx,b.quad.tly,playerSize,playerSize,b.x,b.y,bulletSize,bulletSize))&&(playersKilled.push(d),enemies[+d]="deleted",
c=!1)}c&&ellipse(a.x,a.y,bulletSize,bulletSize)})};